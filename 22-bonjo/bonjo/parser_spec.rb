require 'json'
require_relative 'parser'

describe Parser do
  it "should parse the tweet from the chunk" do
    chunk = "{\"text\":\"Half a chicken for lunch. Think the chicken must have been Jurassic given the size #onlyinamerica http:\\/\\/t.co\\/HbN7ZoHl\",\"in_reply_to_status_id_str\":null,\"entities\":{\"media\":[{\"type\":\"photo\",\"indices\":[98,118],\"media_url_https\":\"https:\\/\\/p.twimg.com\\/AnLtApOCAAI-UXo.jpg\",\"sizes\":{\"small\":{\"resize\":\"fit\",\"h\":453,\"w\":340},\"thumb\":{\"resize\":\"crop\",\"h\":150,\"w\":150},\"large\":{\"resize\":\"fit\",\"h\":1024,\"w\":768},\"medium\":{\"resize\":\"fit\",\"h\":800,\"w\":600}},\"display_url\":\"pic.twitter.com\\/HbN7ZoHl\",\"url\":\"http:\\/\\/t.co\\/HbN7ZoHl\",\"media_url\":\"http:\\/\\/p.twimg.com\\/AnLtApOCAAI-UXo.jpg\",\"id\":176463930741358594,\"id_str\":\"176463930741358594\",\"expanded_url\":\"http:\\/\\/twitter.com\\/MervDM\\/status\\/176463930732969987\\/photo\\/1\"}],\"user_mentions\":[],\"urls\":[],\"hashtags\":[{\"text\":\"onlyinamerica\",\"indices\":[83,97]}]},\"coordinates\":{\"type\":\"Point\",\"coordinates\":[-118.35365916,34.13639291]},\"in_reply_to_status_id\":null,\"place\":{\"bounding_box\":{\"type\":\"Polygon\",\"coordinates\":[[[-124.482003,32.528832],[-114.131211,32.528832],[-114.131211,42.009517],[-124.482003,42.009517]]]},\"country\":\"United States\",\"url\":\"http:\\/\\/api.twitter.com\\/1\\/geo\\/id\\/fbd6d2f5a4e4a15e.json\",\"country_code\":\"US\",\"attributes\":{},\"full_name\":\"California, US\",\"name\":\"California\",\"id\":\"fbd6d2f5a4e4a15e\",\"place_type\":\"admin\"},\"in_reply_to_user_id_str\":null,\"favorited\":false,\"truncated\":false,\"geo\":{\"type\":\"Point\",\"coordinates\":[34.13639291,-118.35365916]},\"in_reply_to_screen_name\":null,\"source\":\"\\u003Ca href=\\\"http:\\/\\/twitter.com\\/#!\\/download\\/iphone\\\" rel=\\\"nofollow\\\"\\u003ETwitter for iPhone\\u003C\\/a\\u003E\",\"created_at\":\"Mon Mar 05 00:27:35 +0000 2012\",\"possibly_sensitive\":false,\"contributors\":null,\"in_reply_to_user_id\":null,\"possibly_sensitive_editable\":true,\"id_str\":\"176463930732969987\",\"user\":{\"listed_count\":5,\"geo_enabled\":true,\"is_translator\":false,\"lang\":\"en\",\"profile_sidebar_border_color\":\"181A1E\",\"default_profile\":false,\"follow_request_sent\":null,\"profile_use_background_image\":true,\"description\":\"Lives and works in Central London; interested in many things\",\"following\":null,\"profile_background_image_url_https\":\"https:\\/\\/si0.twimg.com\\/images\\/themes\\/theme9\\/bg.gif\",\"profile_text_color\":\"666666\",\"contributors_enabled\":false,\"profile_background_image_url\":\"http:\\/\\/a0.twimg.com\\/images\\/themes\\/theme9\\/bg.gif\",\"created_at\":\"Mon Feb 09 18:49:34 +0000 2009\",\"profile_image_url_https\":\"https:\\/\\/si0.twimg.com\\/profile_images\\/1445760103\\/image_normal.jpg\",\"default_profile_image\":false,\"verified\":false,\"profile_link_color\":\"2FC2EF\",\"url\":null,\"favourites_count\":66,\"protected\":false,\"screen_name\":\"MervDM\",\"show_all_inline_media\":false,\"statuses_count\":19090,\"friends_count\":242,\"profile_background_color\":\"1A1B1F\",\"followers_count\":392,\"profile_image_url\":\"http:\\/\\/a0.twimg.com\\/profile_images\\/1445760103\\/image_normal.jpg\",\"name\":\"Merv Metcalf\",\"id_str\":\"20456048\",\"notifications\":null,\"profile_background_tile\":false,\"location\":\"iPhone: 51.514614,-0.133169\",\"id\":20456048,\"time_zone\":\"London\",\"utc_offset\":0,\"profile_sidebar_fill_color\":\"252429\"},\"retweeted\":false,\"id\":176463930732969987,\"retweet_count\":0}\r\n"
    expected_tweet = "Half a chicken for lunch. Think the chicken must have been Jurassic given the size #onlyinamerica http://t.co/HbN7ZoHl"
    
    actual_tweet = Parser.parse_tweet(chunk)
    actual_tweet.should == expected_tweet
  end
end